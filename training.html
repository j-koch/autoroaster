<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Model Training - AutoRoaster</title>
    <link rel="stylesheet" href="./src/styles/training.css">
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar">
        <div class="navbar-brand">‚òï AutoRoaster</div>
        <div class="navbar-user">
            <span class="user-email" id="user-email">Loading...</span>
            <button class="btn-signout" id="signout-btn">Sign Out</button>
        </div>
    </nav>
    
    <!-- Main Layout with Sidebar -->
    <div class="main-layout">
        <!-- Sidebar Navigation -->
        <aside class="sidebar">
            <nav class="sidebar-nav">
                <a href="./dashboard.html" class="sidebar-link">
                    <span class="sidebar-icon">üìä</span>
                    <span class="sidebar-text">Data Manager</span>
                </a>
                <a href="./training.html" class="sidebar-link active">
                    <span class="sidebar-icon">ü§ñ</span>
                    <span class="sidebar-text">Model Training</span>
                </a>
                <a href="./index.html" class="sidebar-link">
                    <span class="sidebar-icon">üß™</span>
                    <span class="sidebar-text">Digital Testbed</span>
                </a>
            </nav>
        </aside>
        
        <!-- Main Content Area -->
        <div class="container">
            <!-- Message Display -->
            <div id="message" class="message"></div>
            
            <!-- View Tabs -->
            <div class="view-tabs">
                <button class="view-tab active" data-view="models">Model Library</button>
                <button class="view-tab" data-view="training">Training Jobs</button>
            </div>
            
            <!-- Model Library View -->
            <div id="models-view" class="view active">
                <div class="models-container">
                    <!-- Left Column: Model List -->
                    <div class="models-column">
                        <div class="models-panel">
                            <h2>Your Models</h2>
                            
                            <!-- Filter Controls -->
                            <div id="model-filter-controls" class="filter-controls" style="display: none;">
                                <div class="filter-row">
                                    <div class="filter-group">
                                        <label for="filter-model-name">Model Name</label>
                                        <input type="text" id="filter-model-name" placeholder="Search models...">
                                    </div>
                                    <div class="filter-group">
                                        <label for="filter-model-status">Status</label>
                                        <select id="filter-model-status">
                                            <option value="">All statuses</option>
                                            <option value="completed">Completed</option>
                                            <option value="failed">Failed</option>
                                        </select>
                                    </div>
                                    <div class="filter-group">
                                        <label for="sort-models-by">Sort by</label>
                                        <select id="sort-models-by">
                                            <option value="created_desc">Date (Newest)</option>
                                            <option value="created_asc">Date (Oldest)</option>
                                            <option value="name_asc">Name (A-Z)</option>
                                            <option value="name_desc">Name (Z-A)</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Loading State -->
                            <div id="models-loading" class="loading">
                                <div class="loading-spinner"></div>
                                <div>Loading your models...</div>
                            </div>
                            
                            <!-- Empty State -->
                            <div id="models-empty" class="empty-state" style="display: none;">
                                <div class="empty-state-icon">ü§ñ</div>
                                <h3>No Models Yet</h3>
                                <p>Complete a training job to create your first model!</p>
                            </div>
                            
                            <!-- Models List -->
                            <div id="models-list" class="models-list" style="display: none;">
                                <!-- Models will be dynamically inserted here -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- Right Column: Model Inspection -->
                    <div class="inspection-column">
                        <div class="inspection-panel">
                            <h3 id="inspection-panel-title">Select a model to inspect</h3>
                            
                            <!-- Model Loading -->
                            <div id="inspection-loading" class="loading" style="display: none;">
                                <div class="loading-spinner"></div>
                                <div>Loading model details...</div>
                            </div>
                            
                            <!-- Model Details -->
                            <div id="inspection-details" style="display: none;">
                                <!-- Model details will be dynamically inserted here -->
                            </div>
                            
                            <!-- Empty State -->
                            <div id="inspection-empty" class="inspection-empty-state">
                                <div class="inspection-empty-icon">üîç</div>
                                <p>Select a model to view details</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Training Jobs View -->
            <div id="training-view" class="view">
                <div class="training-container">
                    <!-- Left Column: Configure Training -->
                    <div class="config-column">
                        <div class="config-panel">
                            <h2>Configure New Training Job</h2>
                            
                            <div class="form-group">
                                <label>Job Name (Optional)</label>
                                <input type="text" id="jobName" placeholder="e.g., Ethiopian Beans Model">
                            </div>

                            <!-- Roast Selection Section -->
                            <div class="roast-selection-section">
                                <h3>Select Training Data</h3>
                                
                                <!-- Filter and Sort Controls -->
                                <div id="training-filter-controls" class="filter-controls">
                                    <div class="filter-row">
                                        <div class="filter-group">
                                            <label for="training-filter-origin">Origin</label>
                                            <input type="text" id="training-filter-origin" placeholder="Filter by origin...">
                                        </div>
                                        <div class="filter-group">
                                            <label for="training-filter-variety">Variety</label>
                                            <input type="text" id="training-filter-variety" placeholder="Filter by variety...">
                                        </div>
                                        <div class="filter-group">
                                            <label for="training-filter-process">Process</label>
                                            <select id="training-filter-process">
                                                <option value="">All processes</option>
                                                <option value="washed">Washed</option>
                                                <option value="natural">Natural</option>
                                                <option value="honey">Honey</option>
                                                <option value="semi-washed">Semi-Washed</option>
                                                <option value="other">Other</option>
                                            </select>
                                        </div>
                                        <div class="filter-group">
                                            <label for="training-sort-by">Sort by</label>
                                            <select id="training-sort-by">
                                                <option value="roast_date_desc">Roast Date (Newest)</option>
                                                <option value="roast_date_asc">Roast Date (Oldest)</option>
                                                <option value="origin_asc">Origin (A-Z)</option>
                                                <option value="origin_desc">Origin (Z-A)</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Roast Selector Table -->
                                <div id="roastSelector" class="roast-selector-table">
                                    <table class="roast-table">
                                        <thead>
                                            <tr>
                                                <th><input type="checkbox" id="select-all" title="Select all"></th>
                                                <th>Date</th>
                                                <th>Roaster</th>
                                                <th>Origin</th>
                                                <th>Variety</th>
                                                <th>Process</th>
                                                <th>Charge</th>
                                                <th>Final</th>
                                                <th>Uploaded</th>
                                            </tr>
                                        </thead>
                                        <tbody id="roast-table-body">
                                            <!-- Roasts will be dynamically inserted here -->
                                        </tbody>
                                    </table>
                                </div>
                                
                                <div class="selection-summary">
                                    <span id="selectedCount">0</span> roasts selected for training
                                </div>
                            </div>

                            <!-- Collapsible Configuration Sections -->
                            <div class="config-sections">
                                <details class="config-section" open>
                                    <summary>Data Configuration</summary>
                                    <div class="config-section-content">
                                        <div class="form-row">
                                            <div class="form-group">
                                                <label>Batch Size</label>
                                                <input type="number" id="batchSize" value="256" min="1">
                                            </div>
                                            <div class="form-group">
                                                <label>Sequence Length</label>
                                                <input type="number" id="sequenceLength" value="60" min="10">
                                            </div>
                                        </div>
                                        <div class="form-row">
                                            <div class="form-group">
                                                <label>Stride</label>
                                                <input type="number" id="stride" value="3" min="1">
                                            </div>
                                            <div class="form-group">
                                                <label>Delay Horizon (seconds)</label>
                                                <input type="number" id="delayHorizon" value="8.0" min="0" step="0.1">
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label>Delay Points</label>
                                            <input type="number" id="delayPoints" value="4" min="1">
                                        </div>
                                    </div>
                                </details>

                                <details class="config-section">
                                    <summary>Model Configuration</summary>
                                    <div class="config-section-content">
                                        <div class="form-row">
                                            <div class="form-group">
                                                <label>Number of Latents</label>
                                                <input type="number" id="nLatents" value="6" min="1">
                                            </div>
                                            <div class="form-group">
                                                <label>Estimator Hidden Dim</label>
                                                <input type="number" id="estimatorHidden" value="32" min="1">
                                            </div>
                                        </div>
                                    </div>
                                </details>

                                <details class="config-section">
                                    <summary>Loss & Regularization</summary>
                                    <div class="config-section-content">
                                        <div class="form-row">
                                            <div class="form-group">
                                                <label>C_b Smoothing Weight</label>
                                                <input type="number" id="cbWeight" value="0.01" min="0" step="0.001">
                                                <small>Smoothing penalty on C_b</small>
                                            </div>
                                            <div class="form-group">
                                                <label>Charge Temperature Weight</label>
                                                <input type="number" id="chargeWeight" value="0.1" min="0" step="0.01">
                                                <small>Encourages beans to start at ambient temp</small>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label>Air Temperature Weight</label>
                                            <input type="number" id="airTempWeight" value="0.1" min="0" step="0.01">
                                            <small>T_air = T_bm consistency penalty when no beans</small>
                                        </div>
                                    </div>
                                </details>

                                <details class="config-section">
                                    <summary>Training Configuration</summary>
                                    <div class="config-section-content">
                                        <div class="form-row">
                                            <div class="form-group">
                                                <label>Learning Rate</label>
                                                <input type="number" id="learningRate" value="0.005" min="0" step="0.0001">
                                            </div>
                                            <div class="form-group">
                                                <label>Max Epochs</label>
                                                <input type="number" id="maxEpochs" value="5000" min="1">
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label>Patience (Early Stopping)</label>
                                            <input type="number" id="patience" value="150" min="1">
                                        </div>
                                        
                                        <h4 style="margin-top: 20px; margin-bottom: 10px;">Learning Rate Scheduler</h4>
                                        <div class="form-row">
                                            <div class="form-group">
                                                <label>Scheduler Factor</label>
                                                <input type="number" id="schedulerFactor" value="0.7" min="0" max="1" step="0.05">
                                                <small>Factor to reduce LR by when loss plateaus</small>
                                            </div>
                                            <div class="form-group">
                                                <label>Scheduler Patience</label>
                                                <input type="number" id="schedulerPatience" value="50" min="1">
                                                <small>Epochs to wait before reducing LR</small>
                                            </div>
                                        </div>
                                        <div class="form-row">
                                            <div class="form-group">
                                                <label>Minimum Learning Rate</label>
                                                <input type="number" id="schedulerMinLr" value="0.000001" min="0" step="0.000001">
                                                <small>Minimum LR threshold (1e-6)</small>
                                            </div>
                                            <div class="form-group" style="display: flex; align-items: center; gap: 10px;">
                                                <input type="checkbox" id="schedulerVerbose" checked>
                                                <label for="schedulerVerbose" style="margin: 0;">Verbose Logging</label>
                                                <small style="display: block; width: 100%;">Print when LR is reduced</small>
                                            </div>
                                        </div>
                                    </div>
                                </details>
                            </div>

                            <button class="btn-primary" id="start-training-btn" style="width: 100%; margin-top: 20px;">
                                üöÄ Start Training
                            </button>
                        </div>
                    </div>

                    <!-- Right Column: Training Jobs Monitor -->
                    <div class="jobs-column">
                        <div class="jobs-panel">
                            <h2>Training Jobs</h2>
                            
                            <!-- Job Status Filters -->
                            <div class="job-filters">
                                <button class="job-filter-btn active" data-status="all">All</button>
                                <button class="job-filter-btn" data-status="running">Running</button>
                                <button class="job-filter-btn" data-status="completed">Completed</button>
                                <button class="job-filter-btn" data-status="failed">Failed</button>
                            </div>
                            
                            <!-- Jobs List -->
                            <div id="jobsList" class="jobs-list">
                                <div class="loading">Loading jobs...</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script type="module" src="./src/pages/training/training.ts"></script>
</body>
</html>
